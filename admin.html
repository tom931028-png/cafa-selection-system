<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°å¸«ç®¡ç†ç³»çµ± | CAFA Admin</title>
    <style>
        /* --- æ ¸å¿ƒä¸»é¡Œ --- */
        :root { --admin-blue: #00308F; --admin-dark: #002266; --admin-gold: #FFD700; --admin-bg: #f4f7fa; }
        body { font-family: "Microsoft JhengHei", Arial, sans-serif; background-color: var(--admin-bg); margin: 0; display: flex; height: 100vh; overflow: hidden; color: #333; }
        
        /* å´é‚Šæ¬„ */
        .sidebar { width: 260px; background: linear-gradient(180deg, var(--admin-blue) 0%, var(--admin-dark) 100%); color: white; display: flex; flex-direction: column; padding-top: 25px; box-shadow: 4px 0 15px rgba(0,0,0,0.1); z-index: 10; }
        .sidebar-header { text-align: center; padding-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px; }
        .menu-item { padding: 15px 25px; cursor: pointer; transition: 0.3s; color: rgba(255,255,255,0.8); display: flex; align-items: center; font-size: 15px; border-left: 5px solid transparent; }
        .menu-item:hover { background: rgba(255,255,255,0.1); color: white; }
        .menu-item.active { background: rgba(0,0,0,0.2); border-left-color: var(--admin-gold); color: white; font-weight: bold; }
        .menu-item span { margin-right: 12px; font-size: 20px; }
        .admin-info { margin-top: auto; padding: 20px; background: rgba(0,0,0,0.25); font-size: 13px; border-top: 1px solid rgba(255,255,255,0.1); text-align: center; }

        /* ä¸»å…§å®¹ */
        .main-content { flex: 1; padding: 30px; overflow-y: auto; background-image: linear-gradient(to bottom, #eef2f7, #f4f7fa); }
        .header-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; background: white; padding: 15px 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .header-title { font-size: 24px; font-weight: bold; color: var(--admin-blue); border-left: 8px solid var(--admin-gold); padding-left: 15px; }
        .card { background: white; border-radius: 12px; padding: 25px; margin-bottom: 25px; border-top: 4px solid var(--admin-blue); box-shadow: 0 5px 20px rgba(0,0,0,0.05); }
        .card h3 { margin-top: 0; color: var(--admin-blue); border-bottom: 1px solid #eee; padding-bottom: 10px; font-size: 18px; }

        /* é¢æ¿èˆ‡è¡¨å–® */
        .control-panel { background-color: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #e9ecef; }
        .student-panel { background-color: #e3f2fd; border-color: #bbdefb; }
        .form-row { display: flex; gap: 15px; margin-bottom: 15px; flex-wrap: wrap; }
        .form-group { flex: 1; min-width: 150px; }
        label { display: block; font-size: 13px; font-weight: bold; margin-bottom: 5px; color: #555; }
        input, select { width: 100%; padding: 10px; border: 2px solid #dae1e7; border-radius: 6px; box-sizing: border-box; }
        
        /* æŒ‰éˆ• */
        .btn { padding: 10px 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; color: white; width: 100%; }
        .btn:hover { filter: brightness(1.1); transform: translateY(-1px); }
        .btn-submit { background-color: var(--admin-blue); } 
        .btn-add { background-color: #00695c; }
        .btn-save { background-color: #2e7d32; }
        .btn-reset { background-color: #546e7a; margin-top: 10px; }
        .btn-del { background-color: #dc3545; width: auto; padding: 5px 12px; font-size: 12px; }

        /* è¡¨æ ¼ */
        table { width: 100%; border-collapse: separate; border-spacing: 0; font-size: 14px; margin-top: 10px; }
        th { background-color: #f1f3f5; padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6; }
        td { padding: 12px; border-bottom: 1px solid #eee; background: white; vertical-align: middle; }
        .tag { padding: 3px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; margin: 2px; display:inline-block;}
        .tag-class { background: #673ab7; color: white; border-radius: 12px; }
        
        /* æ’ä½æ¨£å¼ */
        .rank-badge { padding: 4px 8px; border-radius: 6px; font-weight: bold; font-size: 12px; color: #333; display: inline-flex; align-items: center; gap: 5px; border: 1px solid rgba(0,0,0,0.1); }
        
        #loading { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(255,255,255,0.95); display: flex; justify-content: center; align-items: center; z-index: 999; flex-direction: column; color: var(--admin-blue); font-size: 20px; }
    </style>
</head>
<body>
    <div id="loading"><div>â˜ï¸</div><div>è³‡æ–™åŒæ­¥ä¸­...</div></div>

    <div class="sidebar">
        <div class="sidebar-header"><h2>âœˆï¸ ç®¡ç†ç³»çµ±</h2><div style="font-size:12px;opacity:0.7;">ç©ºè»å®˜æ ¡èª²å‹™çµ„</div></div>
        <div class="menu-item active" onclick="switchTab('monitor')"><span>ğŸŒ</span> å…¨æ ¡ç›£æ§</div>
        <div class="menu-item" onclick="switchTab('ranks')"><span>ğŸ†</span> çæ‡²è¨­å®š</div> <div class="menu-item" onclick="switchTab('schedule')"><span>ğŸ“…</span> æ•™å¸«èª²è¡¨</div>
        <div class="menu-item" onclick="switchTab('students')"><span>ğŸ‘¥</span> å­¸ç”Ÿèˆ‡ç­ç´š</div>
        <div class="menu-item" onclick="switchTab('courses')"><span>ğŸ‘¨â€ğŸ«</span> èª²ç¨‹ç®¡ç†</div>
        <div class="menu-item" onclick="switchTab('grades')"><span>ğŸ“</span> æˆç¸¾èˆ‡åˆ†æ</div>
        <div class="admin-info"><button class="btn btn-reset" onclick="resetSystem()">âš ï¸ åˆå§‹åŒ–ç³»çµ±</button></div>
    </div>

    <div class="main-content">
        <div id="monitor-view">
            <div class="header-bar"><div class="header-title">å…¨æ ¡å­¸ç”Ÿ æ’ä½/é¸èª² ç›£æ§</div></div>
            <div class="card">
                <h3>å­¸ç”Ÿç‹€æ…‹ç¸½è¦½</h3>
                <table><thead><tr><th>å­¸è™Ÿ/å§“å</th><th>ç­ç´š</th><th>ç›®å‰æ’ä½ (GPA)</th><th>è·æ¶¯</th><th>å­¸åˆ†</th><th>é¸èª²æ˜ç´°</th></tr></thead><tbody id="student-list-body"></tbody></table>
            </div>
        </div>

        <div id="ranks-view" style="display: none;">
            <div class="header-bar"><div class="header-title">ğŸ† ç‰Œä½çå‹µèˆ‡æ‡²ç½°è¨­å®š</div></div>
            <div class="card">
                <p style="color:#666; font-size:14px;">åœ¨æ­¤è¨­å®šå„å€‹æˆç¸¾å€æ®µå°æ‡‰çš„ã€Œç¨±è™Ÿã€ã€ã€Œé¡è‰²ã€ä»¥åŠã€Œçæ‡²å…§å®¹ã€ã€‚å­¸ç”Ÿç«¯å°‡æœƒåŒæ­¥é¡¯ç¤ºã€‚</p>
                <table>
                    <thead><tr><th width="15%">ç‰Œä½åç¨±</th><th width="10%">æœ€ä½åˆ†</th><th width="10%">ä»£è¡¨è‰²</th><th>ğŸ çå‹µå…§å®¹ (Reward)</th><th>âš ï¸ æ‡²ç½°å…§å®¹ (Punishment)</th></tr></thead>
                    <tbody id="rank-rules-body"></tbody>
                </table>
                <div style="margin-top:20px; text-align:right;">
                    <button class="btn btn-save" style="width:200px;" onclick="saveRankRules()">ğŸ’¾ å„²å­˜çæ‡²è¨­å®š</button>
                </div>
            </div>
        </div>

        <div id="schedule-view" style="display: none;">
            <div class="header-bar"><div class="header-title">æ•™å¸«èª²è¡¨æŸ¥è©¢</div><button class="btn btn-submit" style="width:auto;" onclick="window.print()">åˆ—å°</button></div>
            <div class="card">
                <div class="form-row"><div class="form-group"><select id="teacher-selector" onchange="renderTeacherSchedule()"><option value="">-- é¸æ•™å®˜ --</option></select></div></div>
                <table id="teacher-schedule-table"><thead><tr><th>ç¯€</th><th>ä¸€</th><th>äºŒ</th><th>ä¸‰</th><th>å››</th><th>äº”</th></tr></thead><tbody id="teacher-schedule-body"></tbody></table>
            </div>
        </div>

        <div id="students-view" style="display: none;">
            <div class="header-bar"><div class="header-title">å­¸ç”Ÿèˆ‡ç­ç´šç®¡ç†</div></div>
            <div class="card">
                <h3>å­¸ç”Ÿç®¡ç†</h3>
                <div class="control-panel student-panel">
                    <div class="form-row">
                        <div class="form-group"><input type="text" id="s_id" placeholder="å­¸è™Ÿ"></div>
                        <div class="form-group"><input type="text" id="s_name" placeholder="å§“å"></div>
                        <div class="form-group"><input type="text" id="s_class" placeholder="ç­ç´š (å¦‚:114-èˆªå¤ª)"></div>
                        <div class="form-group"><input type="text" id="s_pass" placeholder="å¯†ç¢¼"></div>
                    </div>
                    <button class="btn btn-add" onclick="addStudent()">æ–°å¢ / æ›´æ–°</button>
                </div>
                <div style="max-height:300px;overflow-y:auto;">
                    <table id="acc-table"><thead><tr><th>å­¸è™Ÿ</th><th>å§“å</th><th>ç­ç´š</th><th>å¯†ç¢¼</th><th>æ“ä½œ</th></tr></thead><tbody id="account-list-body"></tbody></table>
                </div>
            </div>
            <div class="card">
                <h3>ç­ç´šæ‰¹æ¬¡çŒæª”</h3>
                <div class="control-panel"><div class="form-row"><select id="batch-class" class="form-group"></select><select id="batch-course" class="form-group"></select></div><button class="btn btn-submit" onclick="batchAssign()">ğŸš€ åŸ·è¡ŒçŒæª”</button></div>
            </div>
        </div>

        <div id="courses-view" style="display:none;"><div class="header-bar"><div class="header-title">èª²ç¨‹ç®¡ç†</div></div><div class="card"><div class="control-panel"><div class="form-row"><select id="c_type"><option value="fixed">å¿…ä¿®</option><option value="elective">é¸ä¿®</option></select><input id="c_id" placeholder="ä»£ç¢¼"><input id="c_name" placeholder="åç¨±"><input id="c_cr" type="number" value="2"><input id="c_time" placeholder="æ™‚é–“"><input id="c_loc" placeholder="åœ°é»"><input id="c_tea" placeholder="æ•™å®˜"></div><button class="btn btn-submit" onclick="addCourse()">ç™¼å¸ƒ</button></div><table id="course-table"><thead><tr><th>å±¬æ€§</th><th>åç¨±</th><th>æ™‚é–“</th><th>æ“ä½œ</th></tr></thead><tbody id="course-list"></tbody></table></div></div>
        <div id="grades-view" style="display:none;"><div class="header-bar"><div class="header-title">æˆç¸¾ç®¡ç†</div></div><div class="card"><div class="form-row"><select id="g_stu" onchange="loadGrades()" style="flex:2"></select><button class="btn btn-save" onclick="saveGrades()">å„²å­˜</button></div><table id="grade-table"><thead><tr><th>èª²ç¨‹</th><th>åˆ†</th><th>å…¥</th></tr></thead><tbody id="grade-body"></tbody></table></div></div>

    </div>

    <script type="module">
        import { loadFromCloud, saveToCloud } from './firebase-connect.js';
        const KEYS = { STUDENTS:'cafa_all_students_db', FIXED:'cafa_fixed_courses', ELECTIVE:'cafa_public_electives', RANKS:'cafa_rank_rules' };
        let studentDB=[], fixedCourses=[], electiveCourses=[], rankRules=[];

        window.onload = async () => { showLoading(true); await refreshAll(); showLoading(false); setInterval(refreshAll, 10000); };
        
        window.switchTab = (id) => {
            ['monitor','ranks','schedule','students','courses','grades'].forEach(v=>document.getElementById(v+'-view').style.display='none');
            document.getElementById(id+'-view').style.display='block';
            document.querySelectorAll('.menu-item').forEach(e=>e.classList.remove('active'));
            const m={'monitor':0,'ranks':1,'schedule':2,'students':3,'courses':4,'grades':5};
            document.querySelectorAll('.menu-item')[m[id]].classList.add('active');
        };

        // ç¶å®š
        window.resetSystem=resetSystem; window.saveRankRules=saveRankRules; window.renderTeacherSchedule=renderTeacherSchedule;
        window.addStudent=addStudent; window.deleteStudent=deleteStudent; window.batchAssign=batchAssign;
        window.addCourse=addCourse; window.delCourse=delCourse; window.loadGrades=loadGrades; window.saveGrades=saveGrades;

        async function refreshAll() {
            studentDB = (await loadFromCloud(KEYS.STUDENTS))||[];
            fixedCourses = (await loadFromCloud(KEYS.FIXED))||[];
            electiveCourses = (await loadFromCloud(KEYS.ELECTIVE))||[];
            rankRules = (await loadFromCloud(KEYS.RANKS))||getDefaultRanks(); // è¼‰å…¥ç‰Œä½è¦å‰‡
            
            renderMonitor(); renderRankSettings(); renderStudents(); renderCourses(); updateSels();
        }

        function getDefaultRanks() {
            return [
                {name:'ç‹è€… (Challenger)', min:90, color:'#ffe0b2', reward:'æ¦®è­½å‡ä¸€æ—¥ + ç¦®åˆ¸', punishment:'ç„¡'},
                {name:'é‘½çŸ³ (Diamond)', min:80, color:'#b3e5fc', reward:'å˜‰çä¸€æ¬¡', punishment:'ç„¡'},
                {name:'é»ƒé‡‘ (Gold)', min:70, color:'#fff9c4', reward:'ç„¡', punishment:'ç„¡'},
                {name:'ç™½éŠ€ (Silver)', min:60, color:'#f5f5f5', reward:'ç„¡', punishment:'éœ€åƒåŠ æ™šè‡ªç¿’'},
                {name:'é’éŠ… (Bronze)', min:0, color:'#ffccbc', reward:'ç„¡', punishment:'ç¦è¶³ + ç•™æ ¡è¼”å°'}
            ];
        }

        // --- 1. å…¨æ ¡ç›£æ§ (å«ç‰Œä½è¨ˆç®—) ---
        function renderMonitor() {
            const t = document.getElementById('student-list-body'); t.innerHTML='';
            studentDB.forEach(s => {
                // è¨ˆç®— GPA
                let total=0, credit=0;
                (s.courses||[]).forEach(c => { if(c.score){ total+=c.score*c.credit; credit+=c.credit; } });
                let gpa = credit>0 ? (total/credit).toFixed(1) : 0;
                
                // æ±ºå®šç‰Œä½
                let rank = rankRules.find(r => gpa >= r.min) || rankRules[rankRules.length-1];
                let rankBadge = `<span class="rank-badge" style="background:${rank.color}">${rank.name} (${gpa})</span>`;
                if(credit===0) rankBadge = '<span style="color:#ccc">ç„¡æˆç¸¾</span>';

                let track = s.careerTrack==='pilot'?'ğŸ¦… é£›è¡Œ':(s.careerTrack==='ground'?'ğŸ› ï¸ åœ°å‹¤':'æœªå®š');
                t.innerHTML += `<tr><td>${s.name}<br><small>${s.id}</small></td><td><span class="tag tag-class" style="background:#673ab7;color:white;border-radius:10px;padding:2px 6px;">${s.classId||'-'}</span></td><td>${rankBadge}</td><td>${track}</td><td>${s.totalCredits||0}</td><td>${(s.courses||[]).length} ç§‘</td></tr>`;
            });
        }

        // --- 2. ç‰Œä½è¨­å®š ---
        function renderRankSettings() {
            const t = document.getElementById('rank-rules-body'); t.innerHTML='';
            rankRules.forEach((r, i) => {
                t.innerHTML += `
                    <tr>
                        <td><input value="${r.name}" id="rk-n-${i}" style="width:100%"></td>
                        <td><input type="number" value="${r.min}" id="rk-m-${i}" style="width:100%"></td>
                        <td><input type="color" value="${r.color}" id="rk-c-${i}"></td>
                        <td><input value="${r.reward}" id="rk-r-${i}" style="width:100%"></td>
                        <td><input value="${r.punishment}" id="rk-p-${i}" style="width:100%"></td>
                    </tr>
                `;
            });
        }
        async function saveRankRules() {
            rankRules = rankRules.map((r, i) => ({
                name: document.getElementById(`rk-n-${i}`).value,
                min: parseInt(document.getElementById(`rk-m-${i}`).value),
                color: document.getElementById(`rk-c-${i}`).value,
                reward: document.getElementById(`rk-r-${i}`).value,
                punishment: document.getElementById(`rk-p-${i}`).value
            })).sort((a,b) => b.min - a.min); // ç¢ºä¿æŒ‰åˆ†æ•¸é«˜ä½æ’åº
            
            showLoading(true); await saveToCloud(KEYS.RANKS, rankRules); showLoading(false); alert("çæ‡²è¨­å®šå·²æ›´æ–°ï¼"); renderMonitor();
        }

        // --- 3. æ•™å¸«èª²è¡¨ ---
        function renderTeacherSchedule() {
            const tea = document.getElementById('teacher-selector').value;
            const t = document.getElementById('teacher-schedule-body');
            t.innerHTML = ''; 
            for(let i=1;i<=10;i++) t.innerHTML+=`<tr><td style="background:#eee">${i}</td><td id="t1-${i}"></td><td id="t2-${i}"></td><td id="t3-${i}"></td><td id="t4-${i}"></td><td id="t5-${i}"></td></tr>`;
            if(!tea) return;
            const allC=[...fixedCourses,...electiveCourses].filter(c=>c.teacher===tea);
            const dMap={"ä¸€":1,"äºŒ":2,"ä¸‰":3,"å››":4,"äº”":5};
            allC.forEach(c => {
                if(!c.time) return; let [d,p]=c.time.split('/'); let dy=dMap[d];
                p.split(',').forEach(x => { document.getElementById(`t${dy}-${x}`).innerHTML=`<div style="background:#00308F;color:white;padding:5px;border-radius:4px;font-size:12px;">${c.name}<br>${c.location||''}</div>`; });
            });
        }

        // --- 4. å­¸ç”Ÿ, èª²ç¨‹, æˆç¸¾ (ç²¾ç°¡ç‰ˆ) ---
        async function addStudent() { const id=document.getElementById('s_id').value; const idx=studentDB.findIndex(s=>s.id===id); const obj={id, name:document.getElementById('s_name').value, classId:document.getElementById('s_class').value, password:document.getElementById('s_pass').value, dept:'-', courses:[], totalCredits:0}; if(idx>-1){Object.assign(studentDB[idx], obj);}else{studentDB.push(obj);} await saveToCloud(KEYS.STUDENTS, studentDB); renderStudents(); }
        async function deleteStudent(id) { if(confirm('åˆªé™¤?')){studentDB=studentDB.filter(s=>s.id!==id); await saveToCloud(KEYS.STUDENTS, studentDB); renderStudents();} }
        function renderStudents() { document.getElementById('account-list-body').innerHTML = studentDB.map(s=>`<tr><td>${s.id}</td><td>${s.name}</td><td>${s.classId}</td><td>${s.password}</td><td><button class="btn btn-del" onclick="deleteStudent('${s.id}')">åˆª</button></td></tr>`).join(''); }
        
        async function batchAssign() { 
            const cls=document.getElementById('batch-class').value; const cid=document.getElementById('batch-course').value;
            if(!cls||!cid)return alert("é¸ç­ç´šèª²ç¨‹"); const c=[...fixedCourses,...electiveCourses].find(x=>x.id===cid);
            studentDB.forEach(s=>{ if(s.classId===cls && !s.courses.some(x=>x.id===cid)){ s.courses.push(c); s.totalCredits+=c.credit; }});
            await saveToCloud(KEYS.STUDENTS, studentDB); alert("å®Œæˆ");
        }

        async function addCourse() { const t=document.getElementById('c_type').value; const c={id:document.getElementById('c_id').value, name:document.getElementById('c_name').value, credit:parseInt(document.getElementById('c_cr').value), time:document.getElementById('c_time').value, location:document.getElementById('c_loc').value, teacher:document.getElementById('c_tea').value, type:t==='fixed'?'å¿…ä¿®':'é¸ä¿®', isFixed:t==='fixed', isOpen:true}; if(t==='fixed')fixedCourses.push(c);else electiveCourses.push(c); await saveToCloud(KEYS.FIXED,fixedCourses); await saveToCloud(KEYS.ELECTIVE,electiveCourses); renderCourses(); }
        async function delCourse(t,i) { if(t==='fixed')fixedCourses.splice(i,1);else electiveCourses.splice(i,1); await saveToCloud(KEYS.FIXED,fixedCourses); await saveToCloud(KEYS.ELECTIVE,electiveCourses); renderCourses(); }
        function renderCourses() { document.getElementById('course-list').innerHTML = [...fixedCourses.map((c,i)=>`<tr><td>å¿…ä¿®</td><td>${c.name}</td><td>${c.time}</td><td><button class="btn btn-del" onclick="delCourse('fixed',${i})">åˆª</button></td></tr>`), ...electiveCourses.map((c,i)=>`<tr><td>é¸ä¿®</td><td>${c.name}</td><td>${c.time}</td><td><button class="btn btn-del" onclick="delCourse('elect',${i})">åˆª</button></td></tr>`)].join(''); }

        function loadGrades() { const sid=document.getElementById('g_stu').value; const t=document.getElementById('grade-body'); t.innerHTML=''; const s=studentDB.find(x=>x.id===sid); if(!s)return; s.courses.forEach(c=>{ t.innerHTML+=`<tr><td>${c.name}</td><td>${c.credit}</td><td><input type="number" id="sc-${c.id}" value="${c.score||''}" style="width:50px"></td></tr>`; }); }
        async function saveGrades() { const sid=document.getElementById('g_stu').value; const idx=studentDB.findIndex(x=>x.id===sid); studentDB[idx].courses=studentDB[idx].courses.map(c=>{const v=document.getElementById(`sc-${c.id}`).value; if(v)c.score=parseInt(v); return c;}); await saveToCloud(KEYS.STUDENTS, studentDB); alert("å­˜æª”"); }

        function updateSels() {
            const tea = document.getElementById('teacher-selector'); const allC=[...fixedCourses,...electiveCourses]; 
            const ts=[...new Set(allC.map(c=>c.teacher).filter(x=>x))]; tea.innerHTML='<option value="">-- é¸æ•™å®˜ --</option>'; ts.forEach(t=>tea.add(new Option(t,t)));
            const stu = document.getElementById('g_stu'); stu.innerHTML='<option value="">-- é¸å­¸ç”Ÿ --</option>'; studentDB.forEach(s=>stu.add(new Option(s.name,s.id)));
            const cls = document.getElementById('batch-class'); const cs=[...new Set(studentDB.map(s=>s.classId).filter(x=>x))]; cls.innerHTML='<option value="">-- ç­ç´š --</option>'; cs.forEach(c=>cls.add(new Option(c,c)));
            const bco = document.getElementById('batch-course'); bco.innerHTML='<option value="">-- èª²ç¨‹ --</option>'; allC.forEach(c=>bco.add(new Option(c.name,c.id)));
        }

        async function resetSystem() { 
            if(!confirm("é‡ç½®?"))return; 
            const s=[{id:'11401',name:'æå¤§ç¶­',classId:'114-èˆªå¤ª',password:'1234',courses:[],careerTrack:'pilot'},{id:'11402',name:'ç‹å°ç¾',classId:'114-èˆªç®¡',password:'1234',courses:[],careerTrack:'ground'}]; 
            await saveToCloud(KEYS.STUDENTS,s); await saveToCloud(KEYS.RANKS,getDefaultRanks()); alert("å®Œæˆ"); refreshAll(); 
        }
        function showLoading(s) { document.getElementById('loading').style.display=s?'flex':'none'; }
    </script>
</body>
</html>






